<app-page-layout>
    @if (isPropertiesPopupOpened()) {
    <app-properties-popup
        (close)="closePropertiesPopup()"
        (invalidateQuery)="invalidateProperties()"
    />
    }
    <div class="flex justify-between flex-row w-full items-center">
        <div class="relative inline-flex items-center">
            <app-title-page title="Propriedades" subTitle="Gerencie suas propriedades" />
            <span
                class="absolute top-3 -right-6 px-2 py-0.5 text-xs w-auto flex items-center justify-center rounded-full bg-blue-100 text-blue-600 font-semibold"
            >
                {{ totalProperties() }}
            </span>
        </div>
        <app-button-page (action)="openPropertiesPopup()" text="Nova Propriedade" />
    </div>

    <div class="p-6 flex flex-col w-full gap-2 shadow-sm shadow-blue-200 rounded-2xl h-[65dvh]">
        <div class="w-full flex flex-col gap-7 h-full">
            <app-input-page
                (search)="searchProperties($event)"
                placeholder="Buscar propriedade..."
            />
            @switch (true) { @case (propertiesQuery.isPending()) {
            <div class="w-full h-full flex justify-center items-center p-5">
                <lucide-angular [img]="Loader2" class="animate-spin w-15 h-15" />
            </div>
            } @case (properties().length > 0) {
            <div class="flex flex-col px-5 items-center w-full divide-y divide-gray-200 shadow-">
                <div class="flex flex-row w-full pb-3 px-4 text-center text-gray-400 font-semibold">
                    <span class="flex-1">Identificador</span>
                    <span class="flex-1">Área</span>
                    <span class="flex-1">Preço</span>
                    <span class="flex-1">Status</span>
                    <span class="flex-1">Ações</span>
                </div>
                <div class="flex flex-col w-full divide-y divide-gray-200 text-center">
                    @for (property of properties(); track property.identifier) {
                    <div class="flex flex-row p-4 hover:bg-gray-100 transition items-center">
                        <span class="flex-1 font-semibold text-black/70">{{
                            property.identifier
                        }}</span>
                        <span class="flex-1">{{ property.area }}</span>
                        <span class="flex-1">{{ property.price }}</span>
                        <div class="flex-1">
                            <span
                                class="rounded-full text-white font-semibold py-0.5 px-2 text-sm"
                                [class.bg-primary]="property.status === 'AVAILABLE'"
                                [class.bg-gray-300]="property.status === 'OCCUPIED'"
                                >{{ property.status | propertyStatusTranslate }}</span
                            >
                        </div>
                        <button
                            class="flex-1 font-semibold text-sm h-10 bg-primary text-white rounded-lg cursor-pointer hover-primary"
                        >
                            Detalhar
                        </button>
                    </div>
                    }
                </div>
            </div>
            } @default {
            <div class="w-full h-full flex justify-center items-center">
                <span class="font-semibold">Sem propriedades registradas</span>
            </div>
            } }
        </div>
    </div>
    @if (totalPages() > 1 ) {
    <app-pagination
        (changePage)="changePage($event)"
        [currentPage]="currentPage()"
        [totalPages]="totalPages()"
    />
    }
</app-page-layout>
